<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stravagari Launch Plan: Andromeda 2025</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0B0F14;
        }
        /* Custom scrollbar for better aesthetics */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #0B0F14;
        }
        ::-webkit-scrollbar-thumb {
            background: #FF6A3D;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #ff8a6a;
        }
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0,0,0,0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 50;
            backdrop-filter: blur(4px);
        }
        .modal-content {
            background-color: #121821;
            padding: 2rem;
            border-radius: 1rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
        }
        .modal-close-btn {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: none;
            border: none;
            color: #fff;
            cursor: pointer;
        }
        details > summary {
            list-style: none;
        }
        details > summary::-webkit-details-marker {
            display: none;
        }
        details summary .chevron {
            transition: transform 0.2s;
        }
        details[open] summary .chevron {
            transform: rotate(90deg);
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <!-- React and ReactDOM CDN -->
    <script src="https://unpkg.com/react@17/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>
    <!-- Babel CDN for JSX transpilation -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <script type="text/babel">
        const { useEffect, useMemo, useRef, useState } = React;

        // --- Configuration ---
        const ACCENT = "#FF6A3D";
        const BG = "#0B0F14";

        // --- Icon Components ---
        const Icon = ({ className, children, ...props }) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className} {...props}>{children}</svg>;
        const Rocket = ({ className }) => <Icon className={className}><path d="M4.5 16.5c-1.5 1.26-2 5-2 5s3.74-.5 5-2c.71-.84.7-2.3.05-3.05A7.5 7.5 0 0 0 9 9.5c.7-1 2.2-1.05 3.05-.05.75.75 2.26 1.26 3.05 2.05 1.5 1.5 2.5 4.5 2.5 4.5s-3.5-1-4.5-2.5c-.8-.7-2-1.05-2.05-3.05a7.5 7.5 0 0 0-1.95-1.95C10.5 12.5 9 12.24 8 12c-1.26-.26-2.5-1.5-2.5-2.5s1.24-1.24 2.5-2.5c.7-.7 1.05-2.05 3.05-2.05A7.5 7.5 0 0 0 14.5 9c1 .7 1.05 2.2.05 3.05-.75.75-1.26 2.26-2.05 3.05-1.5 1.5-4.5 2.5-4.5 2.5s1-3.5 2.5-4.5z"/></Icon>;
        const BarChart3 = ({ className }) => <Icon className={className}><path d="M3 3v18h18"/><path d="M18 17V9"/><path d="M13 17V5"/><path d="M8 17v-3"/></Icon>;
        const ListChecks = ({ className }) => <Icon className={className}><path d="m3 17 2 2 4-4"/><path d="m3 7 2 2 4-4"/><path d="M13 6h8"/><path d="M13 12h8"/><path d="M13 18h8"/></Icon>;
        const Calendar = ({ className }) => <Icon className={className}><rect width="18" height="18" x="3" y="4" rx="2" ry="2"/><line x1="16" x2="16" y1="2" y2="6"/><line x1="8" x2="8" y1="2" y2="6"/><line x1="3" x2="21" y1="10" y2="10"/></Icon>;
        const Menu = ({ className }) => <Icon className={className}><line x1="4" x2="20" y1="12" y2="12"/><line x1="4" x2="20" y1="6" y2="6"/><line x1="4" x2="20" y1="18" y2="18"/></Icon>;
        const X = ({ className }) => <Icon className={className}><path d="M18 6 6 18"/><path d="m6 6 12 12"/></Icon>;
        const SparkleIcon = ({ className }) => <Icon className={className}><path d="M10 3L8 8L3 10L8 12L10 17L12 12L17 10L12 8L10 3z"/></Icon>;
        const ChevronRight = ({ className }) => <Icon className={className}><path d="m9 18 6-6-6-6"/></Icon>
        const BrainCircuit = ({ className }) => <Icon className={className}><path d="M12 2a10 10 0 0 0-10 10c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.9-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.9 1.52 2.34 1.08 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.94 0-1.1.39-1.99 1.03-2.69a3.6 3.6 0 0 1 .1-2.64s.84-.27 2.75 1.02a9.58 9.58 0 0 1 5 0c1.91-1.29 2.75-1.02 2.75-1.02.55 1.37.2 2.4.1 2.64.64.7 1.03 1.6 1.03 2.69 0 3.84-2.34 4.68-4.57 4.93.36.31.68.92.68 1.85v2.73c0 .27.16.59.67.5A10 10 0 0 0 22 12 10 10 0 0 0 12 2Z"/></Icon>;

        // --- Gemini API Call Function ---
        async function callGeminiApi(prompt) {
            const apiKey = ""; // Per instructions, remains empty.
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
            const payload = { contents: [{ parts: [{ text: prompt }] }] };

            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                if (!response.ok) {
                    const errorBody = await response.text();
                    throw new Error(`API call failed with status: ${response.status}. Body: ${errorBody}`);
                }
                const result = await response.json();
                const text = result.candidates?.[0]?.content?.parts?.[0]?.text;
                if (text) {
                    return text.replace(/\*/g, '•');
                } else {
                    throw new Error("No content received from API.");
                }
            } catch (err) {
                console.error("Gemini API Error:", err);
                return `An error occurred: ${err.message}`;
            }
        }

        // --- UI Components ---
        function Pill({ children, tone = "neutral" }) {
            const tones = {
                neutral: "bg-white/5 text-white/80 border-white/10",
                ok: "bg-emerald-500/15 text-emerald-300 border-emerald-400/30",
                warn: "bg-amber-500/15 text-amber-300 border-amber-400/30",
                bad: "bg-rose-500/15 text-rose-300 border-rose-400/30",
            };
            return <span className={`px-2.5 py-1 rounded-full text-[11px] font-semibold border whitespace-nowrap ${tones[tone]}`}>{children}</span>;
        }

        function Logo() {
            return (
                <div className="flex items-center gap-2 select-none">
                    <svg width="26" height="26" viewBox="0 0 32 32" className="shrink-0" aria-hidden><defs><linearGradient id="rg" x1="0" y1="0" x2="1" y2="1"><stop offset="0%" stopColor={ACCENT} /><stop offset="100%" stopColor="#FF915E" /></linearGradient></defs><rect rx="8" width="32" height="32" fill="#121821" /><path d="M10 22V10h6a4 4 0 0 1 0 8h-4v4m4-7 4 7" fill="none" stroke="url(#rg)" strokeWidth="2.6" strokeLinecap="round" strokeLinejoin="round" /></svg>
                    <span className="text-lg md:text-xl font-extrabold tracking-tight">ROASIN</span>
                </div>
            );
        }
        
        function Modal({ isOpen, onClose, title, children }) {
            if (!isOpen) return null;
            return (
                <div className="modal-overlay" onClick={onClose}>
                    <div className="modal-content" onClick={(e) => e.stopPropagation()}>
                        <button onClick={onClose} className="modal-close-btn"><X className="w-6 h-6" /></button>
                        <h3 className="text-xl font-bold mb-4 text-white">{title}</h3>
                        <div className="text-white/80 whitespace-pre-wrap">{children}</div>
                    </div>
                </div>
            );
        }

        function Section({ id, title, icon, actions, children }) {
            return (
                <section id={id} className="scroll-mt-24">
                    <div className="flex items-center justify-between mb-3 gap-2">
                        <div className="flex items-center gap-2">
                            <div className="p-1.5 rounded-md" style={{ background: "rgba(255,106,61,0.12)", border: "1px solid rgba(255,106,61,0.25)" }}>{icon}</div>
                            <h2 className="text-xl md:text-2xl font-bold">{title}</h2>
                        </div>
                        {actions}
                    </div>
                    <div className="rounded-xl border border-white/10 bg-white/5 backdrop-blur-xl p-4 md:p-5">{children}</div>
                </section>
            );
        }

        function Kpi({ label, value, hint }) {
            return (
                <div className="rounded-lg border border-white/10 bg-white/5 p-3">
                    <div className="text-xs text-white/70">{label}</div>
                    <div className="text-lg font-bold">{value}</div>
                    {hint && <div className="text-[10px] text-white/50 mt-1">{hint}</div>}
                </div>
            );
        }

        function TopNav({ onJump }) {
            const [open, setOpen] = useState(false);
            const items = [ { id: "overview", label: "Overview" }, { id: "ai-analysis", label: "AI Analysis" }, {id: "decision-engine", label: "Decision Engine"}, { id: "structure", label: "Structure" }, { id: "creative-lab", label: "Creative Lab" }, {id: "daba-sets", label: "DABA Sets"}, { id: "asc", label: "ASC Scale" }, { id: "timeline", label: "Timeline" }, { id: "kpi", label: "KPI & Rules" } ];
            return (
                <header className="sticky top-0 z-40 border-b border-white/10 backdrop-blur-xl bg-black/30">
                    <div className="max-w-7xl mx-auto px-3 md:px-4 py-2.5 flex items-center justify-between">
                        <div className="flex items-center gap-3"><Logo /></div>
                        <nav className="hidden md:flex gap-4 text-sm text-white/80">{items.map((i) => (<button key={i.id} onClick={() => onJump(i.id)} className="hover:text-white">{i.label}</button>))}</nav>
                        <button className="md:hidden p-2 rounded-lg bg-white/5 border border-white/10" onClick={() => setOpen(!open)} aria-label="Toggle menu">{open ? <X className="w-5 h-5" /> : <Menu className="w-5 h-5" />}</button>
                    </div>
                    {open && (<div className="md:hidden border-t border-white/10 bg-black/60 backdrop-blur-xl"><div className="max-w-7xl mx-auto px-3 py-2 grid grid-cols-2 gap-2">{items.map((i) => (<button key={i.id} onClick={() => { setOpen(false); onJump(i.id); }} className="text-left px-3 py-2 rounded-md bg-white/5 hover:bg-white/10 text-sm">{i.label}</button>))}</div></div>)}
                </header>
            );
        }
        
        function Overview({ kpi }) {
            return (
                <Section id="overview" title="Overview" icon={<Rocket className="w-4 h-4" color={ACCENT} />}>
                    <div className="grid md:grid-cols-4 gap-3 mb-4">
                        <Kpi label="Goal (14 days)" value="200–250 purchases" />
                        <Kpi label="Target CPA" value={`≤ ${kpi.cpa} RON`} hint="Editable in KPI & Rules" />
                        <Kpi label="Target ROAS" value={`≥ ${kpi.roas}`} />
                        <Kpi label="Avg. Order Value" value={`~${kpi.aov} RON`} hint="Editable in KPI & Rules"/>
                    </div>
                </Section>
            );
        }
        
        function AIAnalysis({ handleAnalysis }) {
            return (
                 <Section id="ai-analysis" title="AI Analysis & Recommendations" icon={<SparkleIcon className="w-4 h-4" color={ACCENT} />}>
                    <div className="text-center">
                        <p className="text-white/80 text-sm mb-4">Get a performance analysis and strategic recommendations from Gemini, based on the data entered in the Creative Lab.</p>
                        <button onClick={handleAnalysis} className="px-4 py-2 rounded-lg font-semibold shadow-lg hover:opacity-95 flex items-center gap-2 mx-auto disabled:opacity-50" style={{ background: ACCENT, color: "#0B0F14" }}>
                            <SparkleIcon className="w-4 h-4" /> Analyze Performance Now
                        </button>
                    </div>
                </Section>
            );
        }

        function DecisionEngine({ ads, sets, kpi, setAds, setSets, handleExplainDecisions }) {
            const decisions = useMemo(() => {
                const combined = [
                    ...ads.map(ad => ({ ...ad, type: 'ad' })),
                    ...sets.map(set => ({ ...set, type: 'set' }))
                ];

                return combined.map(item => {
                    const cpa = item.purchases > 0 ? item.spend / item.purchases : Infinity;
                    const roas = item.spend > 0 ? (item.purchases * kpi.aov) / item.spend : 0;

                    let decision = "Hold steady";
                    let tone = "warn";
                    let colorClass = "bg-amber-500/10";

                    if (cpa <= kpi.cpa && roas >= 5) {
                        decision = "Scale +20% Budget";
                        tone = "ok";
                        colorClass = "bg-emerald-500/10";
                    } else if (cpa > 65 || (item.spend > 0 && roas < 4)) {
                        decision = "Pause Creative";
                        tone = "bad";
                        colorClass = "bg-rose-500/10";
                    }
                    
                    if (item.spend === 0) {
                         decision = "Awaiting data";
                         tone = "neutral";
                         colorClass = "bg-white/5";
                    }

                    return { ...item, cpa, roas, decision, tone, colorClass };
                });
            }, [ads, sets, kpi]);

            const summary = useMemo(() => {
                const toScale = decisions.filter(d => d.tone === 'ok').map(d => d.name);
                const toPause = decisions.filter(d => d.tone === 'bad').map(d => d.name);
                const toHold = decisions.filter(d => d.tone === 'warn').map(d => d.name);

                let recommendations = [];
                if (toScale.length > 0) recommendations.push(`• Scale the following items immediately: ${toScale.join(', ')}.`);
                if (toPause.length > 0) recommendations.push(`• Consider pausing these underperforming items: ${toPause.join(', ')}.`);
                if (toHold.length > 0) recommendations.push(`• Continue monitoring these items closely: ${toHold.join(', ')}.`);
                if (recommendations.length === 0 && decisions.some(d => d.spend > 0)) return "All items are performing within the 'Hold' threshold. Continue monitoring.";
                if (recommendations.length === 0) return "Not enough data to generate recommendations. Please input spend and purchase data.";
                
                return recommendations.join('\n');

            }, [decisions]);
            
            const applyDecisions = () => {
                const updatedAds = ads.map(ad => {
                    const decisionData = decisions.find(d => d.id === ad.id && d.type === 'ad');
                    let newBudget = ad.budget;
                    if (decisionData) {
                        if (decisionData.decision === "Scale +20% Budget") {
                            newBudget = Math.round(ad.budget * 1.20);
                        } else if (decisionData.decision === "Pause Creative") {
                             newBudget = Math.round(ad.budget * 0.85);
                        }
                    }
                    return { ...ad, budget: newBudget };
                });

                const updatedSets = sets.map(set => {
                    const decisionData = decisions.find(d => d.id === set.id && d.type === 'set');
                    let newBudget = set.budget;
                    if (decisionData) {
                         if (decisionData.decision === "Scale +20% Budget") {
                            newBudget = Math.round(set.budget * 1.20);
                        } else if (decisionData.decision === "Pause Creative") {
                             newBudget = Math.round(set.budget * 0.85);
                        }
                    }
                    return { ...set, budget: newBudget };
                });

                setAds(updatedAds);
                setSets(updatedSets);
                alert("Budgets have been updated according to the decision logic!");
            };

            return (
                <Section id="decision-engine" title="Decision Engine" icon={<BrainCircuit className="w-4 h-4" color={ACCENT} />} actions={
                    <div className="flex items-center gap-2">
                        <button onClick={() => handleExplainDecisions(decisions)} className="px-3 py-2 rounded-lg bg-white/5 border border-white/10 hover:bg-white/10 font-semibold flex items-center gap-2 mx-auto disabled:opacity-50 text-xs text-white/80">
                            <SparkleIcon className="w-4 h-4"/> Explain Decisions (AI)
                        </button>
                        <button onClick={applyDecisions} className="px-4 py-2 rounded-lg font-semibold shadow-lg hover:opacity-95 flex items-center gap-2 mx-auto disabled:opacity-50 text-xs" style={{ background: ACCENT, color: "#0B0F14" }}>Apply Decisions</button>
                    </div>
                }>
                    <div className="grid md:grid-cols-3 gap-4">
                        <div className="md:col-span-2">
                            <div className="overflow-x-auto text-sm">
                                <table className="w-full">
                                   <thead className="text-left text-white/60">
                                        <tr>
                                            <th className="px-3 py-2">Item Name</th>
                                            <th className="px-3 py-2">CPA</th>
                                            <th className="px-3 py-2">ROAS</th>
                                            <th className="px-3 py-2">Recommendation</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {decisions.map(d => (
                                            <tr key={`${d.type}-${d.id}`} className={`${d.colorClass} border-b border-white/10`}>
                                                <td className="px-3 py-2.5 font-semibold">{d.name}</td>
                                                <td className="px-3 py-2.5">{isFinite(d.cpa) ? d.cpa.toFixed(2) : '-'} RON</td>
                                                <td className="px-3 py-2.5">{d.roas.toFixed(2)}</td>
                                                <td className="px-3 py-2.5"><Pill tone={d.tone}>{d.decision}</Pill></td>
                                            </tr>
                                        ))}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <div className="md:col-span-1 rounded-lg border border-white/10 p-3 bg-black/20">
                            <h4 className="font-semibold mb-2">Summary & Recommendations</h4>
                            <p className="text-white/80 whitespace-pre-wrap text-xs">{summary}</p>
                        </div>
                    </div>
                </Section>
            );
        }

        function Structure() {
             const structureData = [
                { 
                    name: "TEST – CBO – Creative Lab", objective: "Sales", budget: "400 RON", goal: "Find winning creatives",
                    adSets: [
                        { name: "Office Elegance", targeting: "Broad, Women 25-55", ads: [{type: "Video & Image", copy: "Step into confidence. Leather boots that elevate every office outfit."}] },
                        { name: "Street Comfort", targeting: "Broad, Women 25-55", ads: [{type: "Video & Image", copy: "Walk your city in comfort. Soft leather, everyday confidence."}] },
                        { name: "Mall Lifestyle", targeting: "Broad, Women 25-55", ads: [{type: "Video & Image", copy: "Comfort meets style. Made for days that don’t stop."}] },
                        { name: "Smart Casual", targeting: "Broad, Women 25-55", ads: [{type: "Video & Image", copy: "Light, elegant, effortless. Perfect from work to weekend."}] },
                    ]
                },
                { 
                    name: "PRO – ASC – Main Scaler", objective: "Sales", budget: "700 RON", goal: "Scale winners",
                    adSets: [
                        { name: "Broad Scaling Ad Set", targeting: "Broad, Women 25-55, Romania", ads: [{type: "Post ID", copy: "Winner 1 from CBO"}, {type: "Post ID", copy: "Winner 2 from CBO"}] },
                    ]
                },
                { 
                    name: "PRO – DABA – Catalog All", objective: "Sales", budget: "400 RON", goal: "Consistent volume",
                    adSets: [
                         { name: "Full Catalog", targeting: "Broad, Women 25-55, Romania", ads: [{type: "Dynamic Product Ad", copy: "Showcasing all products to a broad audience."}] },
                    ]
                },
                { 
                    name: "RET – DPA – ATC/VC 3d", objective: "Sales", budget: "150 RON", goal: "Recover intent",
                    adSets: [
                         { name: "ATC/VC 3 days", targeting: "Users who Added to Cart or Viewed Content in last 3 days", ads: [{type: "Dynamic Product Ad", copy: "Still thinking about them?"}] },
                    ]
                },
            ];
            
            return (
                <Section id="structure" title="Campaign Structure" icon={<BarChart3 className="w-4 h-4" color={ACCENT} />}>
                    <div className="space-y-3 text-sm">
                    {structureData.map(campaign => (
                        <details key={campaign.name} className="bg-white/5 border border-white/10 rounded-lg">
                            <summary className="grid grid-cols-4 gap-4 p-3 cursor-pointer items-center">
                                <span className="font-semibold col-span-2 md:col-span-1">{campaign.name}</span>
                                <span className="hidden md:inline">{campaign.budget}</span>
                                <span className="hidden md:inline">{campaign.goal}</span>
                                <span className="flex items-center justify-end text-white/50">
                                    <ChevronRight className="w-4 h-4 chevron"/>
                                </span>
                            </summary>
                            <div className="border-t border-white/10 p-3 pl-6 space-y-2">
                                {campaign.adSets.map(adSet => (
                                    <div key={adSet.name} className="pl-4 border-l-2 border-white/10">
                                        <p className="font-semibold">{adSet.name}</p>
                                        <p className="text-xs text-white/60 mb-1">Targeting: {adSet.targeting}</p>
                                        {adSet.ads.map((ad, index) => (
                                            <div key={index} className="text-xs p-2 rounded-md bg-black/20 mt-1">
                                                <span className="font-bold">{ad.type}:</span> "{ad.copy}"
                                            </div>
                                        ))}
                                    </div>
                                ))}
                            </div>
                        </details>
                    ))}
                    </div>
                </Section>
            );
        }

        function CreativeLab({ kpi, addWinner, ads, setAds, handleAIAssist }) {
            const update = (i, key, val) => {
                const next = [...ads];
                next[i][key] = val;
                setAds(next);
            };

            const statusOf = (ad) => {
                const cpa = ad.purchases > 0 ? ad.spend / ad.purchases : Infinity;
                const roas = ad.spend > 0 ? (ad.purchases * kpi.aov) / ad.spend : 0;
                if (ad.spend > 70 && ad.purchases === 0) return { label: "KILL", tone: "bad" };
                if (ad.purchases >= 3 && cpa <= kpi.cpa && roas > 5) return { label: "READY", tone: "ok" };
                if (ad.spend > 0) return { label: "MONITOR", tone: "warn" };
                return { label: "PENDING", tone: "neutral" };
            };

            const promote = (ad) => {
                const s = statusOf(ad);
                if (s.label === "READY") {
                    const cpa = ad.purchases > 0 ? ad.spend / ad.purchases : 0;
                    const roas = ad.spend > 0 ? (ad.purchases * kpi.aov) / ad.spend : 0;
                    addWinner({ name: ad.name, cpa: +cpa.toFixed(1), roas: +roas.toFixed(2) });
                }
            };
            
            return (
                <Section id="creative-lab" title="TEST – CBO – Creative Lab" icon={<ListChecks className="w-4 h-4" color={ACCENT} />}>
                    <div className="overflow-x-auto text-sm">
                        <table className="w-full">
                           <thead className="text-left text-white/60">
                                <tr>
                                    <th className="px-2 py-1">Ad Set</th>
                                    <th className="px-2 py-1">Budget (RON)</th>
                                    <th className="px-2 py-1">Spend (RON)</th>
                                    <th className="px-2 py-1">Purchases</th>
                                    <th className="px-2 py-1">CPA</th>
                                    <th className="px-2 py-1">ROAS</th>
                                    <th className="px-2 py-1">Status</th>
                                    <th className="px-2 py-1">Action</th>
                                    <th className="px-2 py-1 text-center">✨ AI Creative Assistant</th>
                                </tr>
                            </thead>
                            <tbody>
                                {ads.map((a, i) => {
                                    const s = statusOf(a);
                                    const cpa = a.purchases > 0 ? (a.spend / a.purchases).toFixed(2) : "-";
                                    const roas = a.spend > 0 ? ((a.purchases * kpi.aov) / a.spend).toFixed(2) : "-";
                                    return (
                                        <tr key={a.id} className="bg-white/5 border-b border-white/10 align-middle">
                                            <td className="px-2 py-1.5 font-semibold">{a.name}</td>
                                            <td className="px-2 py-1.5"><input type="number" min={0} className="w-24 bg-transparent border border-white/10 px-2 py-1 rounded" value={a.budget} onChange={(e) => update(i, "budget", parseFloat(e.target.value || "0"))} /></td>
                                            <td className="px-2 py-1.5"><input type="number" min={0} className="w-24 bg-transparent border border-white/10 px-2 py-1 rounded" value={a.spend} onChange={(e) => update(i, "spend", parseFloat(e.target.value || "0"))} /></td>
                                            <td className="px-2 py-1.5"><input type="number" min={0} className="w-24 bg-transparent border border-white/10 px-2 py-1 rounded" value={a.purchases} onChange={(e) => update(i, "purchases", parseInt(e.target.value || "0"))} /></td>
                                            <td className="px-2 py-1.5">{cpa}</td><td className="px-2 py-1.5">{roas}</td>
                                            <td className="px-2 py-1.5"><Pill tone={s.tone}>{s.label}</Pill></td>
                                            <td className="px-2 py-1.5"><button onClick={() => promote(a)} disabled={s.label !== 'READY'} className="px-3 py-1.5 rounded-md text-xs font-semibold disabled:opacity-40 disabled:cursor-not-allowed" style={{ background: ACCENT, color: BG }}>Promote → ASC</button></td>
                                            <td className="px-2 py-1.5">
                                                <div className="flex justify-center items-center gap-1.5">
                                                    <button onClick={() => handleAIAssist('copy', a.name)} title="Generate Ad Copy" className="p-1.5 rounded-md text-xs font-semibold" style={{ background: 'rgba(255,106,61,0.2)', border: '1px solid rgba(255,106,61,0.4)', color: '#FF915E' }}>Copy</button>
                                                    <button onClick={() => handleAIAssist('headlines', a.name)} title="Generate Headlines" className="p-1.5 rounded-md text-xs font-semibold" style={{ background: 'rgba(255,106,61,0.2)', border: '1px solid rgba(255,106,61,0.4)', color: '#FF915E' }}>Headlines</button>
                                                    <button onClick={() => handleAIAssist('visuals', a.name)} title="Generate Visual Ideas" className="p-1.5 rounded-md text-xs font-semibold" style={{ background: 'rgba(255,106,61,0.2)', border: '1px solid rgba(255,106,61,0.4)', color: '#FF915E' }}>Visuals</button>
                                                </div>
                                            </td>
                                        </tr>
                                    );
                                })}
                            </tbody>
                        </table>
                    </div>
                </Section>
            );
        }
        
        function DabaSets({ sets, setSets, kpi }) {
            const update = (i, key, val) => {
                const next = [...sets];
                next[i][key] = val;
                setSets(next);
            };

            return (
                <Section id="daba-sets" title="TEST – DABA – Catalog Sets" icon={<ListChecks className="w-4 h-4" color={ACCENT} />}>
                    <div className="overflow-x-auto text-sm">
                        <table className="w-full">
                           <thead className="text-left text-white/60">
                                <tr>
                                    <th className="px-2 py-1">Catalog Set</th>
                                    <th className="px-2 py-1">Budget (RON)</th>
                                    <th className="px-2 py-1">Spend (RON)</th>
                                    <th className="px-2 py-1">Purchases</th>
                                    <th className="px-2 py-1">CPA</th>
                                    <th className="px-2 py-1">ROAS</th>
                                </tr>
                            </thead>
                            <tbody>
                                {sets.map((s, i) => {
                                    const cpa = s.purchases > 0 ? (s.spend / s.purchases).toFixed(2) : "-";
                                    const roas = s.spend > 0 ? ((s.purchases * kpi.aov) / s.spend).toFixed(2) : "-";
                                    return (
                                        <tr key={s.id} className="bg-white/5 border-b border-white/10 align-middle">
                                            <td className="px-2 py-1.5 font-semibold">{s.name}</td>
                                            <td className="px-2 py-1.5"><input type="number" min={0} className="w-24 bg-transparent border border-white/10 px-2 py-1 rounded" value={s.budget} onChange={(e) => update(i, "budget", parseFloat(e.target.value || "0"))} /></td>
                                            <td className="px-2 py-1.5"><input type="number" min={0} className="w-24 bg-transparent border border-white/10 px-2 py-1 rounded" value={s.spend} onChange={(e) => update(i, "spend", parseFloat(e.target.value || "0"))} /></td>
                                            <td className="px-2 py-1.5"><input type="number" min={0} className="w-24 bg-transparent border border-white/10 px-2 py-1 rounded" value={s.purchases} onChange={(e) => update(i, "purchases", parseInt(e.target.value || "0"))} /></td>
                                            <td className="px-2 py-1.5">{cpa}</td>
                                            <td className="px-2 py-1.5">{roas}</td>
                                        </tr>
                                    );
                                })}
                            </tbody>
                        </table>
                    </div>
                </Section>
            );
        }

        function ASCScale({ winners }) {
            return (
                <Section id="asc" title="PRO – ASC – Main Scaler" icon={<Rocket className="w-4 h-4" color={ACCENT} />}>
                    {winners.length === 0 ? (<p className="text-center text-white/60 text-sm">No winners promoted. Promote ads from the Creative Lab!</p>) : (
                        <div className="overflow-x-auto text-sm">
                             <table className="w-full">
                                <thead className="text-left text-white/60">
                                    <tr><th className="px-3 py-2">Ad (from Test)</th><th className="px-3 py-2">Initial CPA</th><th className="px-3 py-2">Initial ROAS</th><th className="px-3 py-2">Status</th></tr>
                                </thead>
                                <tbody>{winners.map((w, idx) => (<tr key={idx} className="bg-white/5 border-b border-white/10"><td className="px-3 py-2.5 font-semibold">{w.name}</td><td className="px-3 py-2.5">{w.cpa} RON</td><td className="px-3 py-2.5">{w.roas}</td><td className="px-3 py-2.5"><Pill tone="ok">Ready to Scale</Pill></td></tr>))}</tbody>
                            </table>
                        </div>
                    )}
                </Section>
            );
        }
        
        function Timeline() {
            const steps = [
                { day: "1–2", focus: "Launch", actions: "Publish TEST CBO + DABA + RET. Verify Pixel/CAPI." },
                { day: "3–5", focus: "Collect", actions: "Monitor CTR/CPM/purchases. Kill 0‑sale ads with spend > 70 RON." },
                { day: "6–8", focus: "Promote", actions: "Move winners (CPA≤60, ROAS≥5) to ASC. Keep Post IDs." },
                { day: "9–11", focus: "Optimize", actions: "+20% budgets on ASC/DABA if stable. Keep TEST flat." },
                { day: "12–14", focus: "Decide", actions: "Move more winners or retest angles in CBO." },
            ];
            return (
                <Section id="timeline" title="Timeline — Day 1–14" icon={<Calendar className="w-4 h-4" color={ACCENT} />}>
                     <div className="overflow-x-auto text-sm">
                        <table className="w-full">
                           <thead className="text-left text-white/60">
                                <tr>
                                    <th className="px-3 py-2">Day</th><th className="px-3 py-2">Focus</th><th className="px-3 py-2">Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                {steps.map((s, idx) => (
                                    <tr key={idx} className="bg-white/5 border-b border-white/10">
                                        <td className="px-3 py-2.5 font-semibold">{s.day}</td>
                                        <td className="px-3 py-2.5">{s.focus}</td>
                                        <td className="px-3 py-2.5">{s.actions}</td>
                                    </tr>
                                ))}
                            </tbody>
                        </table>
                    </div>
                </Section>
            );
        }

        function KpiRules({ kpi, setKpi }) {
            return (
                <Section id="kpi" title="KPI Targets & Decision Rules" icon={<BarChart3 className="w-4 h-4" color={ACCENT} />}>
                    <div className="grid md:grid-cols-2 gap-4 text-sm">
                        <div className="space-y-2">
                            <div className="rounded-lg border border-white/10 p-3 bg-black/20">
                                <div className="font-semibold mb-2">Edit KPI Thresholds</div>
                                <div className="grid grid-cols-3 gap-2">
                                    <label className="text-xs">CPA (RON)<input type="number" className="mt-1 w-full bg-transparent border border-white/10 px-2 py-1 rounded" value={kpi.cpa} onChange={(e) => setKpi(p => ({ ...p, cpa: parseFloat(e.target.value || "0") }))} /></label>
                                    <label className="text-xs">ROAS<input type="number" step="0.1" className="mt-1 w-full bg-transparent border border-white/10 px-2 py-1 rounded" value={kpi.roas} onChange={(e) => setKpi(p => ({ ...p, roas: parseFloat(e.target.value || "0") }))} /></label>
                                    <label className="text-xs">AOV (RON)<input type="number" step="1" className="mt-1 w-full bg-transparent border border-white/10 px-2 py-1 rounded" value={kpi.aov} onChange={(e) => setKpi(p => ({ ...p, aov: parseFloat(e.target.value || "0") }))} /></label>
                                </div>
                            </div>
                        </div>
                        <div className="rounded-lg border border-white/10 p-3 bg-black/20 space-y-2">
                            <div className="font-semibold">Daily Budget Rules</div>
                            <ul className="list-disc ml-5 text-white/80 space-y-1"><li>ROAS ≥ 6 → increase budget by <b>+20%</b></li><li>ROAS &lt; 4 or CPA &gt; 65 → reduce budget by <b>−15%</b></li></ul>
                        </div>
                    </div>
                </Section>
            );
        }

        // --- Main App Component ---
        function StravagariDashboard() {
            const glow = useRef(null);
            const [kpi, setKpi] = useState({ cpa: 60, roas: 6, aov: 250 });
            const [winners, setWinners] = useState([]);
            const [ads, setAds] = useState([
                { id: 1, name: "Office Elegance", spend: 0, purchases: 0, budget: 100 }, 
                { id: 2, name: "Street Comfort", spend: 0, purchases: 0, budget: 100 },
                { id: 3, name: "Mall Lifestyle", spend: 0, purchases: 0, budget: 100 }, 
                { id: 4, name: "Smart Casual", spend: 0, purchases: 0, budget: 100 },
            ]);
            const [sets, setSets] = useState([
                { id: 1, name: "Boots (DABA)", spend: 0, purchases: 0, budget: 70 },
                { id: 2, name: "Loafers (DABA)", spend: 0, purchases: 0, budget: 70 },
            ]);
            const [modalState, setModalState] = useState({ isOpen: false, title: "", content: "" });
            const [isLoading, setIsLoading] = useState(false);


            useEffect(() => {
                const onScroll = () => { if (!glow.current) return; const y = window.scrollY * 0.08; glow.current.style.transform = `translate3d(-15%, ${-10 + y}px, 0)`; };
                window.addEventListener("scroll", onScroll);
                return () => window.removeEventListener("scroll", onScroll);
            }, []);

            const addWinner = (w) => {
                setWinners((prev) => {
                    const exists = prev.some((x) => x.name === w.name);
                    if (!exists) {
                        alert(`"${w.name}" has been promoted to the scaling campaign!`);
                        return [...prev, w];
                    }
                    alert(`"${w.name}" is already in the scaling campaign.`);
                    return prev;
                });
            };

            const jumpTo = (id) => { const el = document.getElementById(id); if (el) el.scrollIntoView({ behavior: "smooth", block: "start" }); };
            
            const handleAIAssist = async (type, adName) => {
                let prompt = "";
                let newModalTitle = "";
                switch (type) {
                    case 'copy':
                        newModalTitle = `✨ Ad Copy for "${adName}"`;
                        prompt = `You are an expert e-commerce fashion copywriter. Generate 3 short and persuasive ad copy variations (Primary Text) for a Facebook/Instagram ad for women's natural leather footwear. Brand: Stravagari.ro. Ad theme: "${adName}". Target audience: women 35-55, urban, active. Tone: Elegant, confident. Requirements: Each variation must include a hook, the main benefit (comfort, style, quality), and a call-to-action. Use relevant emojis.`;
                        break;
                    case 'headlines':
                        newModalTitle = `✨ Headlines for "${adName}"`;
                        prompt = `You are a marketing expert. Generate 5 Headline variations for a Facebook ad. The headlines must be short (max 7 words), impactful, and attention-grabbing. The theme is '${adName}' for the brand Stravagari.ro (leather footwear).`;
                        break;
                    case 'visuals':
                        newModalTitle = `✨ Visual Ideas for "${adName}"`;
                        prompt = `You are a creative director. Propose 3 visual concepts (photo/video) for an Instagram ad for Stravagari.ro (women's leather footwear). Theme: "${adName}". For each concept, describe: 1. The scenario, 2. The atmosphere, 3. The setting.`;
                        break;
                }
                setModalState({ isOpen: true, title: newModalTitle, content: "" });
                setIsLoading(true);
                const result = await callGeminiApi(prompt);
                setModalState(prev => ({ ...prev, content: result }));
                setIsLoading(false);
            };
            
            const handleAnalysis = async () => {
                setModalState({ isOpen: true, title: "✨ AI Performance Analysis", content: "" });
                setIsLoading(true);

                const dataSummary = ads.filter(ad => ad.spend > 0).map(ad => `• Ad Set '${ad.name}': Spend ${ad.spend} RON, Purchases ${ad.purchases}`).join('\n');

                if (dataSummary.length === 0) {
                    setModalState(prev => ({...prev, content: "Please enter data in the Creative Lab section to generate an analysis."}));
                    setIsLoading(false);
                    return;
                }

                const prompt = `You are an expert media buyer. Analyze the following campaign data for Stravagari.ro, a women's leather footwear brand. The data is:\n${dataSummary}\n\nThe target KPIs are:\n- CPA: under ${kpi.cpa} RON\n- ROAS: over ${kpi.roas}\n- Average Order Value (AOV) is ${kpi.aov} RON.\n\nProvide a summary with 3-4 key points. Identify the top-performing ad sets (potential winners) and those that need attention (potential losers). Offer a clear strategic recommendation for the next 24-48 hours. Be concise and to the point. IMPORTANT: Format your entire response using natural language with paragraphs and bullet points. Do not use a markdown table.`;
                
                const result = await callGeminiApi(prompt);
                setModalState(prev => ({ ...prev, content: result }));
                setIsLoading(false);
            };
            
            const handleExplainDecisions = async (decisions) => {
                setModalState({ isOpen: true, title: "✨ AI Decision Explanation", content: "" });
                setIsLoading(true);

                const decisionsSummary = decisions
                    .filter(d => d.spend > 0)
                    .map(d => `• '${d.name}' with ROAS ${d.roas.toFixed(2)} and CPA ${isFinite(d.cpa) ? d.cpa.toFixed(2) : 'N/A'} RON has the recommendation: '${d.decision}'.`)
                    .join('\n');

                if (decisionsSummary.length === 0) {
                    setModalState(prev => ({...prev, content: "Not enough data to explain. Please input performance data first."}));
                    setIsLoading(false);
                    return;
                }

                const prompt = `You are a senior media buyer, providing a high-level strategic overview. Based on the following performance data and automated recommendations, provide a 2-3 sentence summary explaining the 'why' behind these decisions. What is the overall health of the account? What should be the main focus for the next 24 hours?\n\nData:\n${decisionsSummary}\n\nYour Explanation:`;
                
                const result = await callGeminiApi(prompt);
                setModalState(prev => ({ ...prev, content: result }));
                setIsLoading(false);
            };

            return (
                <div className="min-h-screen text-white">
                    <div className="fixed inset-0 pointer-events-none -z-10" aria-hidden><div ref={glow} className="absolute -top-24 -left-24 w-[520px] h-[520px] rounded-full blur-3xl opacity-40" style={{ background: "radial-gradient(40% 40% at 50% 50%, rgba(255,106,61,.35), transparent)" }} /></div>
                    <TopNav onJump={jumpTo} />
                    <main className="max-w-7xl mx-auto px-3 md:px-4 py-6 md:py-8 space-y-8">
                        <Overview kpi={kpi} />
                        <AIAnalysis handleAnalysis={handleAnalysis} />
                        <DecisionEngine ads={ads} sets={sets} kpi={kpi} setAds={setAds} setSets={setSets} handleExplainDecisions={handleExplainDecisions} />
                        <Structure />
                        <CreativeLab kpi={kpi} addWinner={addWinner} ads={ads} setAds={setAds} handleAIAssist={handleAIAssist} />
                        <DabaSets sets={sets} setSets={setSets} kpi={kpi} />
                        <ASCScale winners={winners} />
                        <Timeline />
                        <KpiRules kpi={kpi} setKpi={setKpi} />
                        <div className="py-6 text-center text-xs text-white/60">© {new Date().getFullYear()} ROASIN • Stravagari Launch Framework v3.9</div>
                    </main>
                    <Modal 
                        isOpen={modalState.isOpen} 
                        onClose={() => setModalState({ isOpen: false, title: "", content: "" })} 
                        title={modalState.title}>
                        {isLoading ? "Gemini is working..." : modalState.content}
                    </Modal>
                </div>
            );
        }

        ReactDOM.render(<StravagariDashboard />, document.getElementById('root'));
    </script>
</body>
</html>

